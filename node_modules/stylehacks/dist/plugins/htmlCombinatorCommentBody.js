'use strict';

exports.__esModule = true;

var _exists = require('../exists');

var _exists2 = _interopRequireDefault(_exists);

var _plugin = require('../plugin');

var _plugin2 = _interopRequireDefault(_plugin);

var _postcssSelectorParser = require('postcss-selector-parser');

var _postcssSelectorParser2 = _interopRequireDefault(_postcssSelectorParser);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var targets = ['ie 7', 'ie 6', 'ie 5.5'];

function analyse(ctx, rule) {
    return function (selectors) {
        selectors.each(function (selector) {
            if ((0, _exists2.default)(selector, 0, 'html') && ((0, _exists2.default)(selector, 1, '>') || (0, _exists2.default)(selector, 1, '~')) && selector.at(2) && selector.at(2).type === 'comment' && (0, _exists2.default)(selector, 3, ' ') && (0, _exists2.default)(selector, 4, 'body') && (0, _exists2.default)(selector, 5, ' ') && selector.at(6)) {
                ctx.push(rule, {
                    identifier: 'selector',
                    hack: selector.toString()
                });
            }
        });
    };
}

exports.default = (0, _plugin2.default)(targets, ['rule'], function (rule) {
    if (rule.selector && rule.raws.selector && rule.raws.selector.raw) {
        (0, _postcssSelectorParser2.default)(analyse(this, rule)).process(rule.raws.selector.raw);
    }
});
module.exports = exports['default'];